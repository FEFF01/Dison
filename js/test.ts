
import Dison, { Tokenizer } from './index';

let esprima = require("./test/esprima.js")

const parser = new Dison();

import data1 from './test/test_data1.js'
import data2 from './test/test_data2.js'
import data3 from './test/test_data3.js'
import data4 from './test/test_data4.js'
import data5 from './test/test_data5.js'
import data6 from './test/test_data6.js'
import data7 from './test/test_data7.js'

let data0 = (window as any).test.innerHTML;

let test_data = data0
let a, b;

console.time("dison");
console.log(a = parser.parseModule(test_data));
console.timeEnd("dison");
console.time("esprima");
console.log(b = esprima.parseModule(test_data, {
    range: true,
    loc: true
}));
console.timeEnd("esprima");

console.log(123, weakEqual(a, b));
(window as any).parser = parser;
(window as any).esprima = esprima;

let tokenizer = new Tokenizer();
(window as any).tokenizer = tokenizer;


console.log(parser.parseModule(data0).body);

let tast_list: Array<[string, any]> = [
    [
        `
        let test1\\u0061asd = "\\u{0000000be} \\u0044 \\\\ \\x44s \\0112  \\ns"+/s[s/]/
        `,
        { "type": "Program", "sourceType": "script", "body": [{ "type": "VariableDeclaration", "kind": "let", "declarations": [{ "type": "VariableDeclarator", "id": { "type": "Identifier", "name": "test1aasd", "range": [13, 27], "loc": { "start": { "line": 1, "column": 12 }, "end": { "line": 1, "column": 26 } } }, "init": { "type": "BinaryExpression", "left": { "type": "Literal", "value": "Â¾ D \\ Ds \t2  \ns", "raw": "\"\\u{0000000be} \\u0044 \\\\ \\x44s \\0112  \\ns\"", "range": [30, 72], "loc": { "start": { "line": 1, "column": 29 }, "end": { "line": 1, "column": 71 } } }, "operator": "+", "right": { "type": "Literal", "value": {}, "raw": "/s[s/]/", "regex": { "pattern": "s[s/]", "flags": "" }, "range": [73, 80], "loc": { "start": { "line": 1, "column": 72 }, "end": { "line": 1, "column": 79 } } }, "range": [30, 80], "loc": { "start": { "line": 1, "column": 29 }, "end": { "line": 1, "column": 79 } } }, "range": [13, 80], "loc": { "start": { "line": 1, "column": 12 }, "end": { "line": 1, "column": 79 } } }], "range": [9, 80], "loc": { "start": { "line": 1, "column": 8 }, "end": { "line": 1, "column": 79 } } }], "range": [0, 89], "loc": { "start": { "line": 0, "column": 0 }, "end": { "line": 2, "column": 8 } } }
    ],
    [
        `
        ++a
        ++
        b+c++
        (e)
        c++
        [D]
        ++
        b+(c++)[D]
        //b+c++[D]
        `,
        { "type": "Program", "sourceType": "script", "body": [{ "type": "ExpressionStatement", "expression": { "type": "UpdateExpression", "operator": "++", "argument": { "type": "Identifier", "name": "a", "range": [11, 12], "loc": { "start": { "line": 1, "column": 10 }, "end": { "line": 1, "column": 11 } } }, "prefix": true, "range": [9, 12], "loc": { "start": { "line": 1, "column": 8 }, "end": { "line": 1, "column": 11 } } }, "range": [9, 12], "loc": { "start": { "line": 1, "column": 8 }, "end": { "line": 1, "column": 11 } } }, { "type": "ExpressionStatement", "expression": { "type": "BinaryExpression", "left": { "type": "UpdateExpression", "operator": "++", "argument": { "type": "Identifier", "name": "b", "range": [32, 33], "loc": { "start": { "line": 3, "column": 8 }, "end": { "line": 3, "column": 9 } } }, "prefix": true, "range": [21, 33], "loc": { "start": { "line": 2, "column": 8 }, "end": { "line": 3, "column": 9 } } }, "operator": "+", "right": { "type": "UpdateExpression", "argument": { "type": "Identifier", "name": "c", "range": [34, 35], "loc": { "start": { "line": 3, "column": 10 }, "end": { "line": 3, "column": 11 } } }, "operator": "++", "prefix": false, "range": [34, 37], "loc": { "start": { "line": 3, "column": 10 }, "end": { "line": 3, "column": 13 } } }, "range": [21, 37], "loc": { "start": { "line": 2, "column": 8 }, "end": { "line": 3, "column": 13 } } }, "range": [21, 37], "loc": { "start": { "line": 2, "column": 8 }, "end": { "line": 3, "column": 13 } } }, { "type": "ExpressionStatement", "expression": { "type": "Identifier", "name": "e", "range": [46, 49], "loc": { "start": { "line": 4, "column": 8 }, "end": { "line": 4, "column": 11 } } }, "range": [46, 49], "loc": { "start": { "line": 4, "column": 8 }, "end": { "line": 4, "column": 11 } } }, { "type": "ExpressionStatement", "expression": { "type": "UpdateExpression", "argument": { "type": "Identifier", "name": "c", "range": [58, 59], "loc": { "start": { "line": 5, "column": 8 }, "end": { "line": 5, "column": 9 } } }, "operator": "++", "prefix": false, "range": [58, 61], "loc": { "start": { "line": 5, "column": 8 }, "end": { "line": 5, "column": 11 } } }, "range": [58, 61], "loc": { "start": { "line": 5, "column": 8 }, "end": { "line": 5, "column": 11 } } }, { "type": "ExpressionStatement", "expression": { "type": "ArrayExpression", "elements": [{ "type": "Identifier", "name": "D", "range": [71, 72], "loc": { "start": { "line": 6, "column": 9 }, "end": { "line": 6, "column": 10 } } }], "range": [70, 73], "loc": { "start": { "line": 6, "column": 8 }, "end": { "line": 6, "column": 11 } } }, "range": [70, 73], "loc": { "start": { "line": 6, "column": 8 }, "end": { "line": 6, "column": 11 } } }, { "type": "ExpressionStatement", "expression": { "type": "BinaryExpression", "left": { "type": "UpdateExpression", "operator": "++", "argument": { "type": "Identifier", "name": "b", "range": [93, 94], "loc": { "start": { "line": 8, "column": 8 }, "end": { "line": 8, "column": 9 } } }, "prefix": true, "range": [82, 94], "loc": { "start": { "line": 7, "column": 8 }, "end": { "line": 8, "column": 9 } } }, "operator": "+", "right": { "type": "MemberExpression", "object": { "type": "UpdateExpression", "argument": { "type": "Identifier", "name": "c", "range": [96, 97], "loc": { "start": { "line": 8, "column": 11 }, "end": { "line": 8, "column": 12 } } }, "operator": "++", "prefix": false, "range": [95, 100], "loc": { "start": { "line": 8, "column": 10 }, "end": { "line": 8, "column": 15 } } }, "property": { "type": "Identifier", "name": "D", "range": [101, 102], "loc": { "start": { "line": 8, "column": 16 }, "end": { "line": 8, "column": 17 } } }, "computed": true, "range": [95, 103], "loc": { "start": { "line": 8, "column": 10 }, "end": { "line": 8, "column": 18 } } }, "range": [82, 103], "loc": { "start": { "line": 7, "column": 8 }, "end": { "line": 8, "column": 18 } } }, "range": [82, 103], "loc": { "start": { "line": 7, "column": 8 }, "end": { "line": 8, "column": 18 } } }], "range": [0, 131], "loc": { "start": { "line": 0, "column": 0 }, "end": { "line": 10, "column": 8 } } }
    ],
    [
        `6*a%[a][b]()*c,a,b?new [].c[10][20]()[10]:d`,
        { "type": "Program", "sourceType": "script", "body": [{ "type": "ExpressionStatement", "expression": { "type": "SequenceExpression", "expressions": [{ "type": "BinaryExpression", "left": { "type": "BinaryExpression", "left": { "type": "BinaryExpression", "left": { "type": "Literal", "value": 6, "raw": "6", "range": [0, 1], "loc": { "start": { "line": 0, "column": 0 }, "end": { "line": 0, "column": 1 } } }, "operator": "*", "right": { "type": "Identifier", "name": "a", "range": [2, 3], "loc": { "start": { "line": 0, "column": 2 }, "end": { "line": 0, "column": 3 } } }, "range": [0, 3], "loc": { "start": { "line": 0, "column": 0 }, "end": { "line": 0, "column": 3 } } }, "operator": "%", "right": { "type": "CallExpression", "callee": { "type": "MemberExpression", "object": { "type": "ArrayExpression", "elements": [{ "type": "Identifier", "name": "a", "range": [5, 6], "loc": { "start": { "line": 0, "column": 5 }, "end": { "line": 0, "column": 6 } } }], "range": [4, 7], "loc": { "start": { "line": 0, "column": 4 }, "end": { "line": 0, "column": 7 } } }, "property": { "type": "Identifier", "name": "b", "range": [8, 9], "loc": { "start": { "line": 0, "column": 8 }, "end": { "line": 0, "column": 9 } } }, "computed": true, "range": [4, 10], "loc": { "start": { "line": 0, "column": 4 }, "end": { "line": 0, "column": 10 } } }, "arguments": [], "range": [4, 12], "loc": { "start": { "line": 0, "column": 4 }, "end": { "line": 0, "column": 12 } } }, "range": [0, 12], "loc": { "start": { "line": 0, "column": 0 }, "end": { "line": 0, "column": 12 } } }, "operator": "*", "right": { "type": "Identifier", "name": "c", "range": [13, 14], "loc": { "start": { "line": 0, "column": 13 }, "end": { "line": 0, "column": 14 } } }, "range": [0, 14], "loc": { "start": { "line": 0, "column": 0 }, "end": { "line": 0, "column": 14 } } }, { "type": "Identifier", "name": "a", "range": [15, 16], "loc": { "start": { "line": 0, "column": 15 }, "end": { "line": 0, "column": 16 } } }, { "type": "ConditionalExpression", "test": { "type": "Identifier", "name": "b", "range": [17, 18], "loc": { "start": { "line": 0, "column": 17 }, "end": { "line": 0, "column": 18 } } }, "consequent": { "type": "MemberExpression", "object": { "type": "NewExpression", "callee": { "type": "MemberExpression", "object": { "type": "MemberExpression", "object": { "type": "MemberExpression", "object": { "type": "ArrayExpression", "elements": [], "range": [23, 25], "loc": { "start": { "line": 0, "column": 23 }, "end": { "line": 0, "column": 25 } } }, "property": { "type": "Identifier", "name": "c", "range": [26, 27], "loc": { "start": { "line": 0, "column": 26 }, "end": { "line": 0, "column": 27 } } }, "computed": false, "range": [23, 27], "loc": { "start": { "line": 0, "column": 23 }, "end": { "line": 0, "column": 27 } } }, "property": { "type": "Literal", "value": 10, "raw": "10", "range": [28, 30], "loc": { "start": { "line": 0, "column": 28 }, "end": { "line": 0, "column": 30 } } }, "computed": true, "range": [23, 31], "loc": { "start": { "line": 0, "column": 23 }, "end": { "line": 0, "column": 31 } } }, "property": { "type": "Literal", "value": 20, "raw": "20", "range": [32, 34], "loc": { "start": { "line": 0, "column": 32 }, "end": { "line": 0, "column": 34 } } }, "computed": true, "range": [23, 35], "loc": { "start": { "line": 0, "column": 23 }, "end": { "line": 0, "column": 35 } } }, "arguments": [], "range": [19, 37], "loc": { "start": { "line": 0, "column": 19 }, "end": { "line": 0, "column": 37 } } }, "property": { "type": "Literal", "value": 10, "raw": "10", "range": [38, 40], "loc": { "start": { "line": 0, "column": 38 }, "end": { "line": 0, "column": 40 } } }, "computed": true, "range": [19, 41], "loc": { "start": { "line": 0, "column": 19 }, "end": { "line": 0, "column": 41 } } }, "alternate": { "type": "Identifier", "name": "d", "range": [42, 43], "loc": { "start": { "line": 0, "column": 42 }, "end": { "line": 0, "column": 43 } } }, "range": [17, 43], "loc": { "start": { "line": 0, "column": 17 }, "end": { "line": 0, "column": 43 } } }], "range": [0, 43], "loc": { "start": { "line": 0, "column": 0 }, "end": { "line": 0, "column": 43 } } }, "range": [0, 43], "loc": { "start": { "line": 0, "column": 0 }, "end": { "line": 0, "column": 43 } } }], "range": [0, 43], "loc": { "start": { "line": 0, "column": 0 }, "end": { "line": 0, "column": 43 } } }
    ], [
        `yield* a.b.c?a+b:/fsd/ig&&d;void function *(){yield* a.b.c?a+b:/fsd/ig&&d}`,
        { "type": "Program", "sourceType": "script", "body": [{ "type": "ExpressionStatement", "expression": { "type": "ConditionalExpression", "test": { "type": "BinaryExpression", "left": { "type": "Identifier", "name": "yield", "range": [0, 5], "loc": { "start": { "line": 0, "column": 0 }, "end": { "line": 0, "column": 5 } } }, "operator": "*", "right": { "type": "MemberExpression", "object": { "type": "MemberExpression", "object": { "type": "Identifier", "name": "a", "range": [7, 8], "loc": { "start": { "line": 0, "column": 7 }, "end": { "line": 0, "column": 8 } } }, "property": { "type": "Identifier", "name": "b", "range": [9, 10], "loc": { "start": { "line": 0, "column": 9 }, "end": { "line": 0, "column": 10 } } }, "computed": false, "range": [7, 10], "loc": { "start": { "line": 0, "column": 7 }, "end": { "line": 0, "column": 10 } } }, "property": { "type": "Identifier", "name": "c", "range": [11, 12], "loc": { "start": { "line": 0, "column": 11 }, "end": { "line": 0, "column": 12 } } }, "computed": false, "range": [7, 12], "loc": { "start": { "line": 0, "column": 7 }, "end": { "line": 0, "column": 12 } } }, "range": [0, 12], "loc": { "start": { "line": 0, "column": 0 }, "end": { "line": 0, "column": 12 } } }, "consequent": { "type": "BinaryExpression", "left": { "type": "Identifier", "name": "a", "range": [13, 14], "loc": { "start": { "line": 0, "column": 13 }, "end": { "line": 0, "column": 14 } } }, "operator": "+", "right": { "type": "Identifier", "name": "b", "range": [15, 16], "loc": { "start": { "line": 0, "column": 15 }, "end": { "line": 0, "column": 16 } } }, "range": [13, 16], "loc": { "start": { "line": 0, "column": 13 }, "end": { "line": 0, "column": 16 } } }, "alternate": { "type": "LogicalExpression", "left": { "type": "Literal", "value": {}, "raw": "/fsd/ig", "regex": { "pattern": "fsd", "flags": "ig" }, "range": [17, 24], "loc": { "start": { "line": 0, "column": 17 }, "end": { "line": 0, "column": 24 } } }, "operator": "&&", "right": { "type": "Identifier", "name": "d", "range": [26, 27], "loc": { "start": { "line": 0, "column": 26 }, "end": { "line": 0, "column": 27 } } }, "range": [17, 27], "loc": { "start": { "line": 0, "column": 17 }, "end": { "line": 0, "column": 27 } } }, "range": [0, 27], "loc": { "start": { "line": 0, "column": 0 }, "end": { "line": 0, "column": 27 } } }, "range": [0, 28], "loc": { "start": { "line": 0, "column": 0 }, "end": { "line": 0, "column": 28 } } }, { "type": "ExpressionStatement", "expression": { "type": "UnaryExpression", "operator": "void", "argument": { "type": "FunctionExpression", "async": false, "generator": true, "id": null, "params": [], "body": { "type": "BlockStatement", "body": [{ "type": "ExpressionStatement", "expression": { "type": "YieldExpression", "argument": { "type": "ConditionalExpression", "test": { "type": "MemberExpression", "object": { "type": "MemberExpression", "object": { "type": "Identifier", "name": "a", "range": [53, 54], "loc": { "start": { "line": 0, "column": 53 }, "end": { "line": 0, "column": 54 } } }, "property": { "type": "Identifier", "name": "b", "range": [55, 56], "loc": { "start": { "line": 0, "column": 55 }, "end": { "line": 0, "column": 56 } } }, "computed": false, "range": [53, 56], "loc": { "start": { "line": 0, "column": 53 }, "end": { "line": 0, "column": 56 } } }, "property": { "type": "Identifier", "name": "c", "range": [57, 58], "loc": { "start": { "line": 0, "column": 57 }, "end": { "line": 0, "column": 58 } } }, "computed": false, "range": [53, 58], "loc": { "start": { "line": 0, "column": 53 }, "end": { "line": 0, "column": 58 } } }, "consequent": { "type": "BinaryExpression", "left": { "type": "Identifier", "name": "a", "range": [59, 60], "loc": { "start": { "line": 0, "column": 59 }, "end": { "line": 0, "column": 60 } } }, "operator": "+", "right": { "type": "Identifier", "name": "b", "range": [61, 62], "loc": { "start": { "line": 0, "column": 61 }, "end": { "line": 0, "column": 62 } } }, "range": [59, 62], "loc": { "start": { "line": 0, "column": 59 }, "end": { "line": 0, "column": 62 } } }, "alternate": { "type": "LogicalExpression", "left": { "type": "Literal", "value": {}, "raw": "/fsd/ig", "regex": { "pattern": "fsd", "flags": "ig" }, "range": [63, 70], "loc": { "start": { "line": 0, "column": 63 }, "end": { "line": 0, "column": 70 } } }, "operator": "&&", "right": { "type": "Identifier", "name": "d", "range": [72, 73], "loc": { "start": { "line": 0, "column": 72 }, "end": { "line": 0, "column": 73 } } }, "range": [63, 73], "loc": { "start": { "line": 0, "column": 63 }, "end": { "line": 0, "column": 73 } } }, "range": [53, 73], "loc": { "start": { "line": 0, "column": 53 }, "end": { "line": 0, "column": 73 } } }, "delegate": true, "range": [46, 73], "loc": { "start": { "line": 0, "column": 46 }, "end": { "line": 0, "column": 73 } } }, "range": [46, 73], "loc": { "start": { "line": 0, "column": 46 }, "end": { "line": 0, "column": 73 } } }] }, "expression": false, "range": [33, 74], "loc": { "start": { "line": 0, "column": 33 }, "end": { "line": 0, "column": 74 } } }, "prefix": true, "range": [28, 74], "loc": { "start": { "line": 0, "column": 28 }, "end": { "line": 0, "column": 74 } } }, "range": [28, 74], "loc": { "start": { "line": 0, "column": 28 }, "end": { "line": 0, "column": 74 } } }], "range": [0, 74], "loc": { "start": { "line": 0, "column": 0 }, "end": { "line": 0, "column": 74 } } }
    ], [
        `
        a,b?new [].c[10][20]()[10]:d;
        await- a.b.c?a+b:/fsd/ig&&d;
        async a=>await- a.b.c?a+b:/fsd/ig&&d;
        `,
        { "type": "Program", "sourceType": "script", "body": [{ "type": "ExpressionStatement", "expression": { "type": "SequenceExpression", "expressions": [{ "type": "Identifier", "name": "a", "range": [9, 10], "loc": { "start": { "line": 1, "column": 8 }, "end": { "line": 1, "column": 9 } } }, { "type": "ConditionalExpression", "test": { "type": "Identifier", "name": "b", "range": [11, 12], "loc": { "start": { "line": 1, "column": 10 }, "end": { "line": 1, "column": 11 } } }, "consequent": { "type": "MemberExpression", "object": { "type": "NewExpression", "callee": { "type": "MemberExpression", "object": { "type": "MemberExpression", "object": { "type": "MemberExpression", "object": { "type": "ArrayExpression", "elements": [], "range": [17, 19], "loc": { "start": { "line": 1, "column": 16 }, "end": { "line": 1, "column": 18 } } }, "property": { "type": "Identifier", "name": "c", "range": [20, 21], "loc": { "start": { "line": 1, "column": 19 }, "end": { "line": 1, "column": 20 } } }, "computed": false, "range": [17, 21], "loc": { "start": { "line": 1, "column": 16 }, "end": { "line": 1, "column": 20 } } }, "property": { "type": "Literal", "value": 10, "raw": "10", "range": [22, 24], "loc": { "start": { "line": 1, "column": 21 }, "end": { "line": 1, "column": 23 } } }, "computed": true, "range": [17, 25], "loc": { "start": { "line": 1, "column": 16 }, "end": { "line": 1, "column": 24 } } }, "property": { "type": "Literal", "value": 20, "raw": "20", "range": [26, 28], "loc": { "start": { "line": 1, "column": 25 }, "end": { "line": 1, "column": 27 } } }, "computed": true, "range": [17, 29], "loc": { "start": { "line": 1, "column": 16 }, "end": { "line": 1, "column": 28 } } }, "arguments": [], "range": [13, 31], "loc": { "start": { "line": 1, "column": 12 }, "end": { "line": 1, "column": 30 } } }, "property": { "type": "Literal", "value": 10, "raw": "10", "range": [32, 34], "loc": { "start": { "line": 1, "column": 31 }, "end": { "line": 1, "column": 33 } } }, "computed": true, "range": [13, 35], "loc": { "start": { "line": 1, "column": 12 }, "end": { "line": 1, "column": 34 } } }, "alternate": { "type": "Identifier", "name": "d", "range": [36, 37], "loc": { "start": { "line": 1, "column": 35 }, "end": { "line": 1, "column": 36 } } }, "range": [11, 37], "loc": { "start": { "line": 1, "column": 10 }, "end": { "line": 1, "column": 36 } } }], "range": [9, 37], "loc": { "start": { "line": 1, "column": 8 }, "end": { "line": 1, "column": 36 } } }, "range": [9, 38], "loc": { "start": { "line": 1, "column": 8 }, "end": { "line": 1, "column": 37 } } }, { "type": "ExpressionStatement", "expression": { "type": "ConditionalExpression", "test": { "type": "BinaryExpression", "left": { "type": "Identifier", "name": "await", "range": [47, 52], "loc": { "start": { "line": 2, "column": 8 }, "end": { "line": 2, "column": 13 } } }, "operator": "-", "right": { "type": "MemberExpression", "object": { "type": "MemberExpression", "object": { "type": "Identifier", "name": "a", "range": [54, 55], "loc": { "start": { "line": 2, "column": 15 }, "end": { "line": 2, "column": 16 } } }, "property": { "type": "Identifier", "name": "b", "range": [56, 57], "loc": { "start": { "line": 2, "column": 17 }, "end": { "line": 2, "column": 18 } } }, "computed": false, "range": [54, 57], "loc": { "start": { "line": 2, "column": 15 }, "end": { "line": 2, "column": 18 } } }, "property": { "type": "Identifier", "name": "c", "range": [58, 59], "loc": { "start": { "line": 2, "column": 19 }, "end": { "line": 2, "column": 20 } } }, "computed": false, "range": [54, 59], "loc": { "start": { "line": 2, "column": 15 }, "end": { "line": 2, "column": 20 } } }, "range": [47, 59], "loc": { "start": { "line": 2, "column": 8 }, "end": { "line": 2, "column": 20 } } }, "consequent": { "type": "BinaryExpression", "left": { "type": "Identifier", "name": "a", "range": [60, 61], "loc": { "start": { "line": 2, "column": 21 }, "end": { "line": 2, "column": 22 } } }, "operator": "+", "right": { "type": "Identifier", "name": "b", "range": [62, 63], "loc": { "start": { "line": 2, "column": 23 }, "end": { "line": 2, "column": 24 } } }, "range": [60, 63], "loc": { "start": { "line": 2, "column": 21 }, "end": { "line": 2, "column": 24 } } }, "alternate": { "type": "LogicalExpression", "left": { "type": "Literal", "value": {}, "raw": "/fsd/ig", "regex": { "pattern": "fsd", "flags": "ig" }, "range": [64, 71], "loc": { "start": { "line": 2, "column": 25 }, "end": { "line": 2, "column": 32 } } }, "operator": "&&", "right": { "type": "Identifier", "name": "d", "range": [73, 74], "loc": { "start": { "line": 2, "column": 34 }, "end": { "line": 2, "column": 35 } } }, "range": [64, 74], "loc": { "start": { "line": 2, "column": 25 }, "end": { "line": 2, "column": 35 } } }, "range": [47, 74], "loc": { "start": { "line": 2, "column": 8 }, "end": { "line": 2, "column": 35 } } }, "range": [47, 75], "loc": { "start": { "line": 2, "column": 8 }, "end": { "line": 2, "column": 36 } } }, { "type": "ExpressionStatement", "expression": { "type": "ArrowFunctionExpression", "async": true, "generator": false, "id": null, "params": [{ "type": "Identifier", "name": "a", "range": [90, 91], "loc": { "start": { "line": 3, "column": 14 }, "end": { "line": 3, "column": 15 } } }], "body": { "type": "ConditionalExpression", "test": { "type": "AwaitExpression", "argument": { "type": "UnaryExpression", "operator": "-", "argument": { "type": "MemberExpression", "object": { "type": "MemberExpression", "object": { "type": "Identifier", "name": "a", "range": [100, 101], "loc": { "start": { "line": 3, "column": 24 }, "end": { "line": 3, "column": 25 } } }, "property": { "type": "Identifier", "name": "b", "range": [102, 103], "loc": { "start": { "line": 3, "column": 26 }, "end": { "line": 3, "column": 27 } } }, "computed": false, "range": [100, 103], "loc": { "start": { "line": 3, "column": 24 }, "end": { "line": 3, "column": 27 } } }, "property": { "type": "Identifier", "name": "c", "range": [104, 105], "loc": { "start": { "line": 3, "column": 28 }, "end": { "line": 3, "column": 29 } } }, "computed": false, "range": [100, 105], "loc": { "start": { "line": 3, "column": 24 }, "end": { "line": 3, "column": 29 } } }, "prefix": true, "range": [98, 105], "loc": { "start": { "line": 3, "column": 22 }, "end": { "line": 3, "column": 29 } } }, "range": [93, 105], "loc": { "start": { "line": 3, "column": 17 }, "end": { "line": 3, "column": 29 } } }, "consequent": { "type": "BinaryExpression", "left": { "type": "Identifier", "name": "a", "range": [106, 107], "loc": { "start": { "line": 3, "column": 30 }, "end": { "line": 3, "column": 31 } } }, "operator": "+", "right": { "type": "Identifier", "name": "b", "range": [108, 109], "loc": { "start": { "line": 3, "column": 32 }, "end": { "line": 3, "column": 33 } } }, "range": [106, 109], "loc": { "start": { "line": 3, "column": 30 }, "end": { "line": 3, "column": 33 } } }, "alternate": { "type": "LogicalExpression", "left": { "type": "Literal", "value": {}, "raw": "/fsd/ig", "regex": { "pattern": "fsd", "flags": "ig" }, "range": [110, 117], "loc": { "start": { "line": 3, "column": 34 }, "end": { "line": 3, "column": 41 } } }, "operator": "&&", "right": { "type": "Identifier", "name": "d", "range": [119, 120], "loc": { "start": { "line": 3, "column": 43 }, "end": { "line": 3, "column": 44 } } }, "range": [110, 120], "loc": { "start": { "line": 3, "column": 34 }, "end": { "line": 3, "column": 44 } } }, "range": [93, 120], "loc": { "start": { "line": 3, "column": 17 }, "end": { "line": 3, "column": 44 } } }, "expression": true, "range": [84, 120], "loc": { "start": { "line": 3, "column": 8 }, "end": { "line": 3, "column": 44 } } }, "range": [84, 121], "loc": { "start": { "line": 3, "column": 8 }, "end": { "line": 3, "column": 45 } } }], "range": [0, 130], "loc": { "start": { "line": 0, "column": 0 }, "end": { "line": 4, "column": 8 } } }
    ],
    [
        "if(a){}else if(b+c){}else if('') console.log();else a:while(b)b:{break a;} !function a(){}[10] ;new function(){}``()",
        { "type": "Program", "sourceType": "script", "body": [{ "type": "IfStatement", "test": { "type": "Identifier", "name": "a", "range": [3, 4], "loc": { "start": { "line": 0, "column": 3 }, "end": { "line": 0, "column": 4 } } }, "consequent": { "type": "BlockStatement", "body": [], "range": [5, 7], "loc": { "start": { "line": 0, "column": 5 }, "end": { "line": 0, "column": 7 } } }, "alternate": { "type": "IfStatement", "test": { "type": "BinaryExpression", "left": { "type": "Identifier", "name": "b", "range": [15, 16], "loc": { "start": { "line": 0, "column": 15 }, "end": { "line": 0, "column": 16 } } }, "operator": "+", "right": { "type": "Identifier", "name": "c", "range": [17, 18], "loc": { "start": { "line": 0, "column": 17 }, "end": { "line": 0, "column": 18 } } }, "range": [15, 18], "loc": { "start": { "line": 0, "column": 15 }, "end": { "line": 0, "column": 18 } } }, "consequent": { "type": "BlockStatement", "body": [], "range": [19, 21], "loc": { "start": { "line": 0, "column": 19 }, "end": { "line": 0, "column": 21 } } }, "alternate": { "type": "IfStatement", "test": { "type": "Literal", "value": "", "raw": "''", "range": [29, 31], "loc": { "start": { "line": 0, "column": 29 }, "end": { "line": 0, "column": 31 } } }, "consequent": { "type": "ExpressionStatement", "expression": { "type": "CallExpression", "callee": { "type": "MemberExpression", "object": { "type": "Identifier", "name": "console", "range": [33, 40], "loc": { "start": { "line": 0, "column": 33 }, "end": { "line": 0, "column": 40 } } }, "property": { "type": "Identifier", "name": "log", "range": [41, 44], "loc": { "start": { "line": 0, "column": 41 }, "end": { "line": 0, "column": 44 } } }, "computed": false, "range": [33, 44], "loc": { "start": { "line": 0, "column": 33 }, "end": { "line": 0, "column": 44 } } }, "arguments": [], "range": [33, 46], "loc": { "start": { "line": 0, "column": 33 }, "end": { "line": 0, "column": 46 } } }, "range": [33, 47], "loc": { "start": { "line": 0, "column": 33 }, "end": { "line": 0, "column": 47 } } }, "alternate": { "type": "LabeledStatement", "label": { "type": "Identifier", "name": "a", "range": [52, 53], "loc": { "start": { "line": 0, "column": 52 }, "end": { "line": 0, "column": 53 } } }, "body": { "type": "WhileStatement", "test": { "type": "Identifier", "name": "b", "range": [60, 61], "loc": { "start": { "line": 0, "column": 60 }, "end": { "line": 0, "column": 61 } } }, "body": { "type": "LabeledStatement", "label": { "type": "Identifier", "name": "b", "range": [62, 63], "loc": { "start": { "line": 0, "column": 62 }, "end": { "line": 0, "column": 63 } } }, "body": { "type": "BlockStatement", "body": [{ "type": "BreakStatement", "label": { "type": "Identifier", "name": "a", "range": [71, 72], "loc": { "start": { "line": 0, "column": 71 }, "end": { "line": 0, "column": 72 } } }, "range": [65, 73], "loc": { "start": { "line": 0, "column": 65 }, "end": { "line": 0, "column": 73 } } }], "range": [64, 74], "loc": { "start": { "line": 0, "column": 64 }, "end": { "line": 0, "column": 74 } } }, "range": [62, 74], "loc": { "start": { "line": 0, "column": 62 }, "end": { "line": 0, "column": 74 } } }, "range": [54, 74], "loc": { "start": { "line": 0, "column": 54 }, "end": { "line": 0, "column": 74 } } }, "range": [52, 74], "loc": { "start": { "line": 0, "column": 52 }, "end": { "line": 0, "column": 74 } } }, "range": [26, 74], "loc": { "start": { "line": 0, "column": 26 }, "end": { "line": 0, "column": 74 } } }, "range": [12, 74], "loc": { "start": { "line": 0, "column": 12 }, "end": { "line": 0, "column": 74 } } }, "range": [0, 74], "loc": { "start": { "line": 0, "column": 0 }, "end": { "line": 0, "column": 74 } } }, { "type": "ExpressionStatement", "expression": { "type": "UnaryExpression", "operator": "!", "argument": { "type": "MemberExpression", "object": { "type": "FunctionExpression", "async": false, "generator": false, "id": { "type": "Identifier", "name": "a", "range": [85, 86], "loc": { "start": { "line": 0, "column": 85 }, "end": { "line": 0, "column": 86 } } }, "params": [], "body": { "type": "BlockStatement", "body": [], "range": [88, 90], "loc": { "start": { "line": 0, "column": 88 }, "end": { "line": 0, "column": 90 } } }, "expression": false, "range": [76, 90], "loc": { "start": { "line": 0, "column": 76 }, "end": { "line": 0, "column": 90 } } }, "property": { "type": "Literal", "value": 10, "raw": "10", "range": [91, 93], "loc": { "start": { "line": 0, "column": 91 }, "end": { "line": 0, "column": 93 } } }, "computed": true, "range": [76, 94], "loc": { "start": { "line": 0, "column": 76 }, "end": { "line": 0, "column": 94 } } }, "prefix": true, "range": [75, 94], "loc": { "start": { "line": 0, "column": 75 }, "end": { "line": 0, "column": 94 } } }, "range": [75, 96], "loc": { "start": { "line": 0, "column": 75 }, "end": { "line": 0, "column": 96 } } }, { "type": "ExpressionStatement", "expression": { "type": "NewExpression", "callee": { "type": "TaggedTemplateExpression", "tag": { "type": "FunctionExpression", "async": false, "generator": false, "id": null, "params": [], "body": { "type": "BlockStatement", "body": [], "range": [110, 112], "loc": { "start": { "line": 0, "column": 110 }, "end": { "line": 0, "column": 112 } } }, "expression": false, "range": [100, 112], "loc": { "start": { "line": 0, "column": 100 }, "end": { "line": 0, "column": 112 } } }, "quasi": { "type": "TemplateLiteral", "expressions": [], "quasis": [{ "type": "TemplateElement", "value": { "raw": "", "cooked": "" }, "tail": true }], "range": [112, 114], "loc": { "start": { "line": 0, "column": 112 }, "end": { "line": 0, "column": 114 } } }, "range": [100, 114], "loc": { "start": { "line": 0, "column": 100 }, "end": { "line": 0, "column": 114 } } }, "arguments": [], "range": [96, 116], "loc": { "start": { "line": 0, "column": 96 }, "end": { "line": 0, "column": 116 } } }, "range": [96, 116], "loc": { "start": { "line": 0, "column": 96 }, "end": { "line": 0, "column": 116 } } }] }
    ]
]
let table = [];

for (const [input, control] of tast_list) {
    let output = parser.parse(input);
    table.push(
        {
            equal: weakEqual(control, output),
            source: input,
            control,
            output
        }
    )
}
console.table(table);



function weakEqual(a: any, b: any) {
    if (typeof a === "object") {
        if (typeof b === "object") {
            if (a !== b) {
                if (a === null || b === null) {
                    return [a, b];
                }
                let keys = new Set(Object.keys(a).concat(Object.keys(b)));
                for (const key of Array.from(keys)) {
                    if (key === "range" || key === "loc") {
                        continue;
                    }
                    let res = weakEqual(a[key], b[key]);
                    if (res !== true) {
                        res.unshift(a, b, key);
                        return res;
                    }
                }
            }
            return true;
        } else {
            return [a, b];
        }
    } else {
        return a === b || [a, b];
    }
}

function deepEqual(a: any, b: any) {
    if (typeof a === "object") {
        if (typeof b === "object") {
            if (a !== b) {
                if (a === null || b === null) {
                    return [a, b];
                }
                let keys = new Set(Object.keys(a).concat(Object.keys(b)));
                for (const key of Array.from(keys)) {
                    let res = deepEqual(a[key], b[key]);
                    if (res !== true) {
                        res.unshift(a, b, key);
                        return res;
                    }
                }
            }
            return true;
        } else {
            return [a, b];
        }
    } else {
        return a === b || [a, b];
    }
}


